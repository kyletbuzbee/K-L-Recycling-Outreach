/**
 * Simple GAS Test Script
 * Tests the TestRunner functionality in Google Apps Script environment
 */

// Test that TestRunner is available
function testTestRunnerAvailability() {
  console.log('=== Testing TestRunner Availability ===');
  try {
    if (typeof TestRunner === 'undefined') {
      console.error('❌ TestRunner is not defined');
      return false;
    }
    
    if (typeof TestRunner.assert === 'undefined') {
      console.error('❌ TestRunner.assert is not defined');
      return false;
    }
    
    console.log('✅ TestRunner is available');
    console.log('✅ TestRunner.assert is available');
    
    // Test basic assertions
    try {
      TestRunner.assert.equals(1 + 1, 2, '1+1 should equal 2');
      console.log('✅ assertEquals works');
    } catch (e) {
      console.error('❌ assertEquals failed:', e.message);
      return false;
    }
    
    try {
      TestRunner.assert.isTrue(true, 'true should be true');
      console.log('✅ isTrue works');
    } catch (e) {
      console.error('❌ isTrue failed:', e.message);
      return false;
    }
    
    try {
      TestRunner.assert.notNull('value', 'value should not be null');
      console.log('✅ notNull works');
    } catch (e) {
      console.error('❌ notNull failed:', e.message);
      return false;
    }
    
    return true;
  } catch (error) {
    console.error('❌ TestRunner error:', error);
    return false;
  }
}

// Test that other test suites are available
function testTestSuitesAvailability() {
  console.log('=== Testing Test Suites Availability ===');
  var available = true;
  
  if (typeof UnitTests_Core === 'undefined') {
    console.error('❌ UnitTests_Core not defined');
    available = false;
  } else {
    console.log('✅ UnitTests_Core is available');
  }
  
  if (typeof IntegrationTests_Prospects === 'undefined') {
    console.error('❌ IntegrationTests_Prospects not defined');
    available = false;
  } else {
    console.log('✅ IntegrationTests_Prospects is available');
  }
  
  if (typeof WorkflowTests === 'undefined') {
    console.error('❌ WorkflowTests not defined');
    available = false;
  } else {
    console.log('✅ WorkflowTests is available');
  }
  
  if (typeof ValidationTests === 'undefined') {
    console.error('❌ ValidationTests not defined');
    available = false;
  } else {
    console.log('✅ ValidationTests is available');
  }
  
  if (typeof OutreachProspectsLogicTests === 'undefined') {
    console.error('❌ OutreachProspectsLogicTests not defined');
    available = false;
  } else {
    console.log('✅ OutreachProspectsLogicTests is available');
  }
  
  return available;
}

// Run a single test from each suite to verify functionality
function runQuickTest() {
  console.log('=== Running Quick Test Suite ===');
  var results = { passed: 0, failed: 0 };
  
  // Run a simple test from each suite
  try {
    if (typeof UnitTests_Core !== 'undefined') {
      UnitTests_Core.testConfigSchemaIntegrity();
      console.log('✅ UnitTests_Core.testConfigSchemaIntegrity passed');
      results.passed++;
    }
  } catch (e) {
    console.error('❌ UnitTests_Core.testConfigSchemaIntegrity failed:', e.message);
    results.failed++;
  }
  
  try {
    if (typeof IntegrationTests_Prospects !== 'undefined') {
      IntegrationTests_Prospects.testCSVParseWithHeaders();
      console.log('✅ IntegrationTests_Prospects.testCSVParseWithHeaders passed');
      results.passed++;
    }
  } catch (e) {
    console.error('❌ IntegrationTests_Prospects.testCSVParseWithHeaders failed:', e.message);
    results.failed++;
  }
  
  try {
    if (typeof WorkflowTests !== 'undefined') {
      WorkflowTests.testProspectToCustomerWorkflow();
      console.log('✅ WorkflowTests.testProspectToCustomerWorkflow passed');
      results.passed++;
    }
  } catch (e) {
    console.error('❌ WorkflowTests.testProspectToCustomerWorkflow failed:', e.message);
    results.failed++;
  }
  
  console.log('\n=== Quick Test Results ===');
  console.log('Passed:', results.passed);
  console.log('Failed:', results.failed);
  
  return results;
}

// Main entry point for quick testing
function runQuickTests() {
  var allPassed = true;
  
  console.log('====================================');
  console.log(' K&L CRM Quick Test Suite');
  console.log('====================================');
  console.log('');
  
  // Test TestRunner availability
  if (!testTestRunnerAvailability()) {
    allPassed = false;
  }
  
  console.log('');
  
  // Test test suites availability
  if (!testTestSuitesAvailability()) {
    allPassed = false;
  }
  
  console.log('');
  
  // Run quick tests
  var quickResults = runQuickTest();
  
  console.log('');
  console.log('====================================');
  console.log(' Total Quick Tests: ' + (quickResults.passed + quickResults.failed));
  console.log(' Passed: ' + quickResults.passed);
  console.log(' Failed: ' + quickResults.failed);
  console.log('====================================');
  
  if (allPassed && quickResults.failed === 0) {
    console.log('✅ All quick tests passed!');
    if (typeof SpreadsheetApp !== 'undefined') {
      SpreadsheetApp.getActiveSpreadsheet().toast('All tests passed!', 'K&L CRM Tests', 5);
    }
  } else {
    console.log('❌ Some tests failed');
    if (typeof SpreadsheetApp !== 'undefined') {
      SpreadsheetApp.getActiveSpreadsheet().toast(quickResults.failed + ' tests failed', 'K&L CRM Tests', 5);
    }
  }
  
  return quickResults;
}